<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
<div class="canvas-app">
    <img src="nodejs.png"/>
    <p>Hello, <%= context.user.firstName %>. This is a web app written in Node.js embedded in your Salesforce page (It could also be written in any other language).</p>
    <p>It is aware of its environment. For example, here are a few things it knows:</p>
    <table>
        <tr><td>User:</td><td><%= context.user.fullName %></td></tr>
        <tr><td>Object:</td><td><%= context.environment.record.attributes.type %></td></tr>
        <tr><td>Id:</td><td><%= context.environment.record.Id %></td></tr>
    </table>
    <table>
        <tr><td>FirstName:</td><td><%= contact.FirstName %></td></tr>
        <tr><td>LastName:</td><td><%= contact.LastName %></td></tr>
        <tr><td>Phone:</td><td><%= contact.Phone %></td></tr>
        <tr><td>Email:</td><td><%= contact.Email %></td></tr>
    </table>

<input type="text" value="<%= contact.Email %>"/>

<button onclick="updateContact()" label="Update Contact"> Update Contact </button>
<script>
    function updateContact() {
        var sr = localStorage.getItem('sfContext');
        console.log(sr);
       
        
        var accId =sr.context.environment.parameters.accountid;
        var url = sr.context.links.sobjectUrl+"Account/" + accId + "?_HttpMethod=PATCH";
        var externalId = 'TEST001';
        var accountInfo = {"Name" : "New Acc Name " + externalId};
          Sfdc.canvas.client.ajax(url,
                {	client : sr.client,
                    method: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify(accountInfo),
                    success : function(data) {
                        if (204 === data.status) {
                            alert("Success");
                        } else {
                            alert("Not Success result code : " + data.status);
                        }
                    }
                });
    }
</script>





    <p>It can also access more data in Salesforce using the REST APIs. With context and APIs, Canvas makes it easy to integrate applications written in any language inside your Salesforce pages.</p>
    <p>For example, the QR Code below is generated in Node.js. Scan it to create a contact on your mobile phone:</p>
    <%- imgTag %>




</div>
</body>
